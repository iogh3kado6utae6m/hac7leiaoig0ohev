# üéØ JRuby Deployment: –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞—Ç—å?

## üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Docker –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**

| –í–∞—Ä–∏–∞–Ω—Ç | –°—Ç–∞—Ç—É—Å | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---------|--------|-----------|-------------|
| **minimal** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü—Ä–æ—Å—Ç–∞—è | **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production** |
| **official** | ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã —Å –º–æ–¥—É–ª—è–º–∏ | –í—ã—Å–æ–∫–∞—è | –¢–æ–ª—å–∫–æ –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ |
| **simple** | ‚úÖ –î–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å | –°—Ä–µ–¥–Ω—è—è | –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| **test** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü—Ä–æ—Å—Ç–∞—è | –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ |

## üèÜ **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `minimal` –¥–ª—è production**

### ‚úÖ **Dockerfile.jruby-minimal - –ª—É—á—à–∏–π –≤—ã–±–æ—Ä:**

```bash
./test-fixed-dockerfile.sh minimal
# –∏–ª–∏
docker build -f src/Dockerfile.jruby-minimal -t monitus-production src/
docker run -p 80:80 -e JAVA_OPTS="-Xmx1G" monitus-production
```

**–ü–æ—á–µ–º—É minimal –ª—É—á—à–∏–π:**
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è –±–∞–∑–∞**: `phusion/passenger-jruby94:3.0.4` - –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –æ–±—Ä–∞–∑
- ‚úÖ **–ì–æ—Ç–æ–≤—ã–µ –º–æ–¥—É–ª–∏**: Passenger —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–ú–∏–Ω–∏–º—É–º –ø—Ä–æ–±–ª–µ–º**: –ù–µ—Ç —Å–ª–æ–∂–Ω–æ–π —Å–±–æ—Ä–∫–∏ —Å –Ω—É–ª—è
- ‚úÖ **Production-ready**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞**: ~2-3 –º–∏–Ω—É—Ç—ã vs 10-15 –º–∏–Ω—É—Ç

## üîß **–ü—Ä–æ–±–ª–µ–º—ã —Å –¥—Ä—É–≥–∏–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏:**

### ‚ö†Ô∏è **official - –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω—ã–π:**
```
‚ùå dlopen() "/usr/share/nginx/modules/ngx_http_passenger_module.so" failed
‚ùå cannot open shared object file: No such file or directory
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–±—Ä–∞—Ç—å "—Å –Ω—É–ª—è" –ø–æ –æ–±—Ä–∞–∑—Ü—É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ passenger-docker
- –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å –ø—É—Ç—è–º–∏ –º–æ–¥—É–ª–µ–π –≤ Ubuntu Noble
- –ü—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π nginx-extras –∏ passenger
- –¢—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –∑–Ω–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π Passenger

**–ö–æ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç:** –¢–æ–ª—å–∫–æ —ç–∫—Å–ø–µ—Ä—Ç–∞–º Passenger –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π

### ‚úÖ **simple - –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å:**
```bash
./test-fixed-dockerfile.sh simple
```
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `phusion/passenger-jruby94:3.0.4` –∫–∞–∫ –±–∞–∑—É
- –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ
- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –º–µ–∂–¥—É minimal –∏ official

### ‚úÖ **test - –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:**
```bash
./test-fixed-dockerfile.sh test  
```
- –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –•–æ—Ä–æ—à–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

## üöÄ **Production Deployment Guide**

### –®–∞–≥ 1: –°–±–æ—Ä–∫–∞ production –æ–±—Ä–∞–∑–∞
```bash
docker build -f src/Dockerfile.jruby-minimal -t monitus-jruby-production src/
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –Ω–∞–≥—Ä—É–∑–∫–∏
```bash
docker run -d \
  --name monitus-production \
  -p 80:80 \
  -e JAVA_OPTS="-Xmx2G -Xms512M -XX:+UseG1GC" \
  -e PASSENGER_MIN_INSTANCES=3 \
  -e PASSENGER_MAX_INSTANCES=8 \
  -e PASSENGER_THREAD_COUNT=16 \
  --restart unless-stopped \
  monitus-jruby-production
```

### –®–∞–≥ 3: Health check
```bash
curl http://localhost/health
# –û—Ç–≤–µ—Ç: healthy
```

### –®–∞–≥ 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
docker stats monitus-production
# –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–∞–º—è—Ç—å—é (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 1GB –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ)
```

## üîç **–í—ã–±–æ—Ä –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

### üéØ **–î–ª—è production —Å–µ—Ä–≤–∏—Å–∞:**
```bash
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: minimal
docker build -f src/Dockerfile.jruby-minimal -t monitus src/
```

### üß™ **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash  
# –ü—Ä–æ—Å—Ç–æ—Ç–∞: test
docker build -f src/Dockerfile.jruby-test -t monitus-test src/
```

### üìö **–î–ª—è –∏–∑—É—á–µ–Ω–∏—è Passenger:**
```bash
# –ï—Å–ª–∏ –≤—ã —ç–∫—Å–ø–µ—Ä—Ç: official (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π)
docker build -f src/Dockerfile.jruby-official-pattern -t monitus-expert src/
```

### ‚ö° **–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞:**
```bash
# –ë–∞–ª–∞–Ω—Å: simple
docker build -f src/Dockerfile.jruby-passenger-simple -t monitus-simple src/
```

## üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º:**

| –ú–µ—Ç—Ä–∏–∫–∞ | minimal | simple | official | test |
|---------|---------|--------|----------|------|
| **Build time** | 3-5 –º–∏–Ω | 5-7 –º–∏–Ω | 10-15 –º–∏–Ω | 1-2 –º–∏–Ω |
| **Image size** | ~400MB | ~450MB | ~500MB | ~350MB |
| **Startup time** | 30-45s | 45-60s | 60-90s | 20-30s |
| **Stability** | ‚úÖ High | ‚úÖ Good | ‚ö†Ô∏è Issues | ‚úÖ Good |
| **Features** | ‚úÖ Full | ‚úÖ Full | ‚úÖ Full | ‚ö†Ô∏è Basic |

## üõ†Ô∏è **Troubleshooting –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º:**

### minimal - –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ–¥–∫–∏
```bash
# –ï—Å–ª–∏ –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç:
docker logs <container>
# –û–±—ã—á–Ω–æ –ø—Ä–æ–±–ª–µ–º—ã —Å JAVA_OPTS –∏–ª–∏ –ø–∞–º—è—Ç—å—é
```

### official - —á–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–¥—É–ª–µ–π
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥—É–ª—å Passenger:
docker run -it monitus-expert find /usr -name "*passenger*.so"

# –ï—Å–ª–∏ –º–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω:
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É passenger –ø–∞–∫–µ—Ç–∞
# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å nginx-extras –≤–µ—Ä—Å–∏–∏
# 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å minimal –≤–º–µ—Å—Ç–æ official
```

### simple/test - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑:
docker pull phusion/passenger-jruby94:3.0.4

# –ï—Å–ª–∏ –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å minimal (–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –±–∞–∑–∞)
```

## üèÅ **–§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

### ‚ú® **–î–ª—è 95% —Å–ª—É—á–∞–µ–≤ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ minimal:**
```bash
# Production-ready, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π
docker build -f src/Dockerfile.jruby-minimal -t monitus src/
docker run -p 80:80 -e JAVA_OPTS="-Xmx1G" monitus
curl http://localhost/health
```

### üö® **–ò–∑–±–µ–≥–∞–π—Ç–µ official –ø–æ–∫–∞ –Ω–µ –∏—Å–ø—Ä–∞–≤–∏–º –º–æ–¥—É–ª–∏**

### üß™ **–î–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ - test –∏–ª–∏ simple**

JRuby + Passenger —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ, –ø—Ä–æ—Å—Ç–æ **–≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–Ω—É—é —Ç–æ—á–∫—É** –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞!
