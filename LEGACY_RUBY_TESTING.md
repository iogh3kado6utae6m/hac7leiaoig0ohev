# Legacy Ruby Testing Guide

## –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≤–∏—Å–∞—é—â–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏ `test-legacy-ruby`

### üîç **–ü–æ—á–µ–º—É —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å–∞—é—Ç:**

1. **Ruby 2.3.8 –æ—á–µ–Ω—å —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è** (2018 –≥–æ–¥)
2. **Gem compilation issues** - nokogiri –∏ –¥—Ä—É–≥–∏–µ native gems –º–æ–≥—É—Ç –Ω–µ —Å–æ–±–∏—Ä–∞—Ç—å—Å—è
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤** - —Ç–µ—Å—Ç—ã –º–æ–≥–ª–∏ –≤–∏—Å–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
4. **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ Ubuntu** –≤–µ—Ä—Å–∏—è–º–∏
5. **Bundler –ø—Ä–æ–±–ª–µ–º—ã** - —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ bundler —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ-–¥—Ä—É–≥–æ–º—É

### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:**

#### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –≤–µ–∑–¥–µ
```yaml
timeout-minutes: 15     # –û–±—â–∏–π —Ç–∞–π–º–∞—É—Ç workflow
timeout-minutes: 5      # –¢–∞–π–º–∞—É—Ç –¥–ª—è Ruby —É—Å—Ç–∞–Ω–æ–≤–∫–∏
timeout-minutes: 8      # –¢–∞–π–º–∞—É—Ç –¥–ª—è bundle install
```

#### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- –ï—Å–ª–∏ `setup-ruby` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø–æ–ø—ã—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ `apt`
- –ï—Å–ª–∏ `bundle install` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí —É—Å—Ç–∞–Ω–æ–≤–∫–∞ gem-–æ–≤ –ø–æ –æ–¥–Ω–æ–º—É
- –ï—Å–ª–∏ –ø–æ–ª–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≥—Ä—É–∑–∏—Ç—Å—è ‚Üí —Ç–µ—Å—Ç —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

#### 3. –£–ª—É—á—à–µ–Ω error handling
```yaml
continue-on-error: true  # –ù–µ –ø–∞–¥–∞—Ç—å –Ω–∞ –æ—à–∏–±–∫–∞—Ö legacy —Ç–µ—Å—Ç–æ–≤
```

#### 4. –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –£–±—Ä–∞–Ω problematic `nokogiri` –∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—É—Ç–∏
- –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ essential gems: `sinatra`, `rack`, `json`
- –î–æ–±–∞–≤–ª–µ–Ω—ã fallback –º–µ—Ç–æ–¥—ã –±–µ–∑ gem-–æ–≤

#### 5. –ò–∑–º–µ–Ω–µ–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—É—Å–∫–æ–≤
```yaml
schedule:
  - cron: '0 6 * * 0'  # –¢–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
```

### üöÄ **–ù–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

#### Level 1: Syntax validation (–≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç)
```ruby
ruby -c prometheus_exporter.rb  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
```

#### Level 2: Basic compatibility (–±–µ–∑ gem-–æ–≤)
```ruby
# –¢–µ—Å—Ç core Ruby functionality
RUBY_VERSION  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
JSON.generate({'test' => 'value'})  # JSON —Ä–∞–±–æ—Ç–∞–µ—Ç
[1,2,3].inject(0, :+)  # Ruby 2.3.8 —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –º–µ—Ç–æ–¥
```

#### Level 3: Full application (–µ—Å–ª–∏ gem-—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å)
```ruby
require_relative 'prometheus_exporter'
app = PrometheusExporterApp.new  # –ü–æ–ª–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### üìä **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

| –¢–µ—Å—Ç | Ruby 2.3.8 | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|------------|-------------|
| **Syntax check** | ‚úÖ –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ |
| **Basic Ruby** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | Core —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª |
| **JSON support** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π gem |
| **Array methods** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –°–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –º–µ—Ç–æ–¥—ã |
| **Gem installation** | ‚ö†Ô∏è –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏—Å—Ç–µ–º—ã |
| **Nokogiri** | ‚ùå –ß–∞—Å—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | Compilation issues |
| **Full app** | ‚ö†Ô∏è –ï—Å–ª–∏ gem-—ã OK | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç gems |

### üõ†Ô∏è **–õ–æ–∫–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ legacy –ø—Ä–æ–±–ª–µ–º:**

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ —Å Ruby 2.3.8:
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
docker run -it --rm ruby:2.3.8 bash

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
cd /app
BUNDLE_GEMFILE=Gemfile.legacy bundle install
ruby -c prometheus_exporter.rb
```

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (rbenv/rvm):
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ruby 2.3.8 —á–µ—Ä–µ–∑ rbenv
rbenv install 2.3.8
rbenv local 2.3.8

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
ruby --version  # –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 2.3.8
ruby -c src/prometheus_exporter.rb
```

### üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

#### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
1. **–ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ Ruby 2.3.8** –¥–ª—è production
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Ruby 3.2+** –∏–ª–∏ Docker –æ–±—Ä–∞–∑—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
3. **Legacy —Ç–µ—Å—Ç—ã** - —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã

#### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
1. **–û—Å–Ω–æ–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤–µ–¥–µ—Ç—Å—è –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö Ruby –≤–µ—Ä—Å–∏—è—Ö
2. **Legacy —Ç–µ—Å—Ç—ã** –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é, –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ä–∞–±–æ—Ç—É
3. **–ï—Å–ª–∏ legacy —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç** - —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

### üîß **Manual testing –Ω–∞ legacy Ruby:**

```bash
# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –±–µ–∑ gem-–æ–≤
ruby -e "
  puts 'Ruby version: ' + RUBY_VERSION
  require 'json'
  puts 'JSON works: ' + JSON.generate({'test' => true}).inspect
  puts 'Array sum (legacy): ' + [1,2,3,4,5].inject(0, :+).to_s
"

# –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ - –±–∞–∑–æ–≤–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –µ—Å—Ç—å
```

### üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ legacy —Ç–µ—Å—Ç–æ–≤:**

Legacy —Ç–µ—Å—Ç—ã —Ç–µ–ø–µ—Ä—å:
- ‚úÖ **–ù–µ –±–ª–æ–∫–∏—Ä—É—é—Ç** –æ—Å–Ω–æ–≤–Ω—ã–µ builds
- ‚úÖ **–ù–µ –∑–∞–≤–∏—Å–∞—é—Ç** –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ (—Ç–∞–π–º–∞—É—Ç—ã 15 –º–∏–Ω—É—Ç)
- ‚úÖ **–î–∞—é—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É** —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **Gracefully –¥–µ–≥—Ä–∞–¥–∏—Ä—É—é—Ç** –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- ‚úÖ **–ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ä–µ–∂–µ** (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–≤–∏—Å–∞—é—â–∏—Ö `test-legacy-ruby` —Ä–µ—à–µ–Ω–∞ —á–µ—Ä–µ–∑:
1. **–ñ–µ—Å—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã** - –±–æ–ª—å—à–µ –Ω–∏–∫–∞–∫–∏—Ö –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –æ–∂–∏–¥–∞–Ω–∏–π
2. **Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏  
3. **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —Ñ–æ–∫—É—Å –Ω–∞ core —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
4. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** - legacy —Ç–µ—Å—Ç—ã –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã

–¢–µ–ø–µ—Ä—å workflow `test-legacy-ruby` –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –∑–∞ —Ä–∞–∑—É–º–Ω–æ–µ –≤—Ä–µ–º—è –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ–ª–µ–∑–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤–º–µ—Å—Ç–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∞–Ω–∏—è.
