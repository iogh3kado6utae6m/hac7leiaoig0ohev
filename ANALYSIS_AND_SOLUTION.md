# üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

## üìã –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ù–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```
[ N 2025-10-30 23:16:09.2177 41/T1 age/Cor/CoreMain.cpp:1016 ]: Passenger core online, PID 41
[ E 2025-10-30 23:16:11.6503 41/T6 age/Cor/SecurityUpdateChecker.h:521 ]: A security update is available...
Oct 30 23:17:01 6744b4f83666 CRON[258]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)
```

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **Nginx –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** –±–µ–∑ –æ—à–∏–±–æ–∫
2. **Passenger core online** - –æ–∫, PID 41
3. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç** 1 –º–∏–Ω—É—Ç—É
4. **–ù–µ—Ç Nginx –æ—à–∏–±–æ–∫** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### ü§î –ü—Ä–æ–±–ª–µ–º–∞:
**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–∞–º–æ–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É.**

–≠—Ç–æ **–ù–ï** nginx –æ—à–∏–±–∫–∞. –≠—Ç–æ **–ù–ï** passenger –æ—à–∏–±–∫–∞. –í–æ–∑–º–æ–∂–Ω–æ:

1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã
2. JRuby/–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä—É—à–∏—Ç—Å—è –º–æ–ª—á–∞
3. –ü—Ä–æ–±–ª–µ–º–∞ —Å Docker –∏–ª–∏ baseimage init

---

## üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ `/tmp/passenger-docker/image/`:

### üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è:

#### 1. JRuby —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (`jruby-9.4.12.0.sh`):
```bash
run /usr/local/rvm/bin/rvm install $RVM_ID
run /usr/local/rvm/bin/rvm-exec $RVM_ID@global gem install $DEFAULT_RUBY_GEMS --no-document
run create_rvm_wrapper_script jruby9.4 $RVM_ID ruby
run create_rvm_wrapper_script jruby $RVM_ID ruby
run create_rvm_wrapper_script ruby3.1 $RVM_ID ruby  # –ö–ª—é—á–µ–≤–æ–µ!
```

#### 2. Passenger native support (`nginx-passenger.sh`):
```bash
if [[ -e /usr/bin/jruby9.4 ]]; then
    run jruby9.4 --dev -S passenger-config build-native-support
    run setuser app jruby9.4 --dev -S passenger-config build-native-support
fi
```

#### 3. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ runit —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
# Nginx service
mkdir -p /etc/service/nginx
echo 'exec /usr/sbin/nginx -g "daemon off;"' > /etc/service/nginx/run

# Nginx log forwarder  
mkdir -p /etc/service/nginx-log-forwarder
echo 'exec svlogd -tt /var/log/nginx/' > /etc/service/nginx-log-forwarder/run
```

---

## ‚ú® –ù–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### üéØ –°–æ–∑–¥–∞–Ω `Dockerfile.jruby-official-pattern`:

1. **–¢–æ—á–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ** buildconfig –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è RVM —É—Å—Ç–∞–Ω–æ–≤–∫–∞** —Å GPG –∫–ª—é—á–∞–º–∏
3. **JRuby 9.4.14.0** —Å Java 17 (–∫–∞–∫ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º jruby-9.4.12.0.sh)
4. **–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä wrapper scripts** –∫–∞–∫ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º finalize.sh
5. **Native support compilation** –¥–ª—è JRuby
6. **–ü—Ä–∞–≤–∏–ª—å–Ω—É—é nginx + runit —Å—Ç—Ä—É–∫—Ç—É—Ä—É**

### üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:
./test-fixed-dockerfile.sh official

# –ò–ª–∏ —Å—Ç–∞—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ (—Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π HTTP —Ç–µ—Å—Ç–æ–≤):
./test-fixed-dockerfile.sh test
```

---

## üìù –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∏—Ç—å:

1. **–ü—Ä–æ–±–ª–µ–º—ã —Å wrapper scripts** - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—á–Ω–æ —Ç–µ –∂–µ –∏–º–µ–Ω–∞ –∏ –ø—É—Ç–∏
2. **–ü—Ä–æ–±–ª–µ–º—ã —Å native support** - precompile –∫–∞–∫ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å runit —Å–µ—Ä–≤–∏—Å–∞–º–∏** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
4. **–ü—Ä–æ–±–ª–µ–º—ã —Å Java –≤–µ—Ä—Å–∏–µ–π** - –∏—Å–ø–æ–ª—å–∑—É–µ–º Java 17 –∫–∞–∫ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º jruby-9.4.12.0.sh

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∏—Ç—å:

1. **–ü—Ä–æ–±–ª–µ–º—É —Å —Ç–∞–π–º–∞—É—Ç–æ–º** - —Ä–∞–Ω–Ω—è—è HTTP –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 15–π —Å–µ–∫—É–Ω–¥–µ
2. **–õ—É—á—à—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É** –ø—Ä–æ–±–ª–µ–º —Å –æ—Ç–≤–µ—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üèÅ –ò—Ç–æ–≥

–ú—ã –ø—Ä–æ—à–ª–∏ –ø—É—Ç—å –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–æ **–ø–æ–ª–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏** passenger-docker.

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π:
1. **ffa4713**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ nginx –¥–∏—Ä–µ–∫—Ç–∏–≤—ã
2. **90ccbb9**: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã passenger-docker
3. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç**: –†–∞–Ω–Ω—è—è HTTP –ø—Ä–æ–≤–µ—Ä–∫–∞

**–£—Å–ø–µ—Ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç —Å –≤—ã—Å–æ–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é.**
